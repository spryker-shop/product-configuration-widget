{% extends template('widget') %}

{% define data = {
    isVisible: _widget.isVisible,
    productConfigurationInstance: _widget.productConfigurationInstance | default,
    productConfigurationTemplate: _widget.productConfigurationTemplate | default,
} %}

{%- block template -%}
    {% if data.isVisible %}
        {{ parent() }}
    {% endif %}
{%- endblock -%}

{% macro getTemplate(templateType, templateName, moduleName) %}
    {% if templateType == 'atom' %}
        {{ atom(templateName, moduleName) }}
    {% endif %}

    {% if templateType == 'molecule' %}
        {{ molecule(templateName, moduleName) }}
    {% endif %}

    {% if templateType == 'organism' %}
        {{ organism(templateName, moduleName) }}
    {% endif %}

    {% if templateType == 'view' %}
        {{ view(templateName, moduleName) }}
    {% endif %}
{% endmacro %}

{% import _self as macros %}

{% block body %}
    {% set isComplete = data.productConfigurationInstance.isComplete %}
    {% set configurationLabel = isComplete ? 'product_configuration_widget.complete' : 'product_configuration_widget.not_complete' %}
    {% set configurationStatus = isComplete ? 'configured' : 'not-configured' %}

    {% include molecule('status') with {
        class: 'spacing-bottom',
        data: {
            label: configurationLabel | trans,
            status: 'waiting',
        },
    } only %}

    {% if isComplete %}
        {% set productConfigurationTemplate = data.productConfigurationTemplate %}
        {% set isTemplateDefined = productConfigurationTemplate.templateType and productConfigurationTemplate.templateName and productConfigurationTemplate.moduleName %}

        {% if isTemplateDefined %}
            {% set configurableComponent = macros.getTemplate(
                productConfigurationTemplate.templateType,
                productConfigurationTemplate.templateName,
                productConfigurationTemplate.moduleName,
                ) | trim %}

            {% include configurableComponent ignore missing with {
                data: {
                    listItems: productConfigurationTemplate.data,
                },
            } only %}
        {% else %}
            <div>
                {{ data.productConfigurationInstance.displayData }}
            </div>
        {% endif %}
    {% endif %}
{% endblock %}
